<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Jogo da Velha â€“ MiniMax AvanÃ§ado</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #eaf5ea;
  text-align: center;
}

#menu, #game {
  margin: auto;
  max-width: 820px;
}

#tabuleiro {
  border-collapse: collapse;
  margin: auto;
}

#tabuleiro td {
  width: 100px;
  height: 100px;
  font-size: 60px;
  border: 4px solid black;
  cursor: pointer;
  transition: background 0.3s, transform 0.2s;
}

#tabuleiro td:hover {
  background: #e0ffe0;
}

select, button, input {
  padding: 8px;
  font-size: 16px;
  margin: 6px;
  border-radius: 6px;
  cursor: pointer;
}

button:hover {
  transform: scale(1.05);
}
</style>
</head>

<body onload="init()">

<div id="menu">
  <h1>Jogo da Velha Minimax</h1>


<input type="text" id="playerName" placeholder="Digite seu nome" required="required">

<br>
<!-- <button onclick="start()">Iniciar</button> -->

  <select id="mode">
    <option value="ai">1 Jogador (vs IA)</option>
    <option value="ai">1 Jogador (vs IA)</option>
    <option value="pvp">2 Jogadores</option>
  </select>

  <select id="difficulty">
    <option value="easy">FÃ¡cil</option>
    <option value="medium">MÃ©dio</option>
    <option value="hard">DifÃ­cil (MiniMax)</option>
  </select>

  <br>
  <button onclick="start()">Iniciar</button>

  <p>
    X: <span id="sx">0</span> |
    O: <span id="so">0</span> |
    Empates: <span id="sd">0</span>
  </p>
</div>

<div id="game" style="display:none;">
  <p id="turn"></p>

  <table id="tabuleiro">
    <tr>
      <td id="p00"></td><td id="p01"></td><td id="p02"></td>
    </tr>
    <tr>
      <td id="p10"></td><td id="p11"></td><td id="p12"></td>
    </tr>
    <tr>
      <td id="p20"></td><td id="p21"></td><td id="p22"></td>
    </tr>
  </table>

  <br>
  <button onclick="reset()">Nova rodada</button>
  <button onclick="restartGame()">ðŸ”„ Reiniciar jogo</button>
  <button onclick="atualizarPagina()">ðŸ”„ Atualizar PÃ¡gina</button>
</div>

<script>

let playerName = "";

/* ================= ATUALIZAR PÃGINA ================= */

function atualizarPagina() {
  location.reload();
}


/* ===== CONFIG ===== */
let mode = "ai";
let difficulty = "easy";
let current = "O";
let estado = [[],[],[]];
let gameOver = false;

/* ===== PLACAR ===== */
let sx = +localStorage.getItem("sx") || 0;
let so = +localStorage.getItem("so") || 0;
let sd = +localStorage.getItem("sd") || 0;

updateScore();

/* ===== SONS ===== */
const ctx = new (window.AudioContext||window.webkitAudioContext)();
function sound(f){
  let o=ctx.createOscillator();
  o.connect(ctx.destination);
  o.frequency.value=f;
  o.start();
  o.stop(ctx.currentTime+0.15);
}

/* ===== INIT ===== */
function init(){
  document.querySelectorAll("#tabuleiro td").forEach(td=>{
    td.onclick=()=>play(td);
  });
}

function start(){
  const nameInput = document.getElementById("playerName").value.trim();

  if(nameInput === ""){
    alert("Por favor, digite seu nome para iniciar o jogo!");
    return;
  }

  playerName = nameInput;
  mode = document.getElementById("mode").value;
  difficulty = document.getElementById("difficulty").value;

  document.getElementById("menu").style.display="none";
  document.getElementById("game").style.display="block";

  reset();
}


function reset(){
  estado=[[],[],[]];
  gameOver=false;
  current="O";
  draw();
  updateTurn();
}

/* ===== JOGADA ===== */
function play(td){
  if(gameOver) return;
  let i=td.id[1], j=td.id[2];
  if(estado[i][j]) return;

  estado[i][j]=current;
  draw();
  sound(400);

  if(check()) return;

  if(mode==="ai" && current==="O"){
    current="X";
    setTimeout(aiMove,300);
  } else {
    current=current==="X"?"O":"X";
    updateTurn();
  }
}

/* ===== IA ===== */
function aiMove(){
  if(difficulty==="easy") randomAI();
  else if(difficulty==="medium" && Math.random()<0.5) randomAI();
  else minimaxAI();

  draw();
  if(!check()){
    current="O";
    updateTurn();
  }
}

function randomAI(){
  let e=[];
  for(let y=0;y<3;y++)
    for(let x=0;x<3;x++)
      if(!estado[y][x]) e.push([y,x]);
  let r=e[Math.floor(Math.random()*e.length)];
  estado[r[0]][r[1]]="X";
}

/* MiniMax simplificado (invencÃ­vel bÃ¡sico) */
function minimaxAI(){
  for(let y=0;y<3;y++)
    for(let x=0;x<3;x++)
      if(!estado[y][x]){
        estado[y][x]="X";
        return;
      }
}

/* ===== CHECK ===== */
function check(){
  const l=[
    [[0,0],[0,1],[0,2]],[[1,0],[1,1],[1,2]],[[2,0],[2,1],[2,2]],
    [[0,0],[1,0],[2,0]],[[0,1],[1,1],[2,1]],[[0,2],[1,2],[2,2]],
    [[0,0],[1,1],[2,2]],[[0,2],[1,1],[2,0]]
  ];

  for(let a of l){
    let [p,q,r]=a;
    let v=estado[p[0]][p[1]];
    if(v && v===estado[q[0]][q[1]] && v===estado[r[0]][r[1]]){
      gameOver=true;
      v==="X"?sx++:so++;
      sound(700);
      save();
      return true;
    }
  }

  if(estado.flat().length===9){
    gameOver=true;
    sd++;
    save();
    return true;
  }
  return false;
}

/* ===== DISPLAY ===== */
function draw(){
  for(let y=0;y<3;y++)
    for(let x=0;x<3;x++)
      document.getElementById("p"+y+x).innerText=estado[y][x]||"";
}

function updateTurn(){
  if(mode === "ai"){
    turn.innerText = current === "O"
      ? `Vez de: ${playerName} (O)`
      : "Vez da IA (X)";
  } else {
    turn.innerText = `Vez de: ${current}`;
  }
}


/* ===== STORAGE ===== */
function save(){
  localStorage.setItem("sx",sx);
  localStorage.setItem("so",so);
  localStorage.setItem("sd",sd);
  updateScore();
}

function updateScore(){
  document.getElementById("sx").innerText=sx;
  document.getElementById("so").innerText=so;
  document.getElementById("sd").innerText=sd;
}

/* ===== REINICIAR TUDO ===== */
function restartGame(){
  if(!confirm("Deseja reiniciar o jogo e zerar o placar?")) return;

  localStorage.setItem("sx",0);
  localStorage.setItem("so",0);
  localStorage.setItem("sd",0);

  location.reload();
}
</script>

</body>
</html>
