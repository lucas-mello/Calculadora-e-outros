<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Jogo da Velha Completo</title>

<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  background: #f5f5f5;
}

#board {
  display: grid;
  grid-template-columns: repeat(3, 100px);
  gap: 5px;
  justify-content: center;
  margin: 20px auto;
}

.cell {
  width: 100px;
  height: 100px;
  font-size: 2.5em;
  cursor: pointer;
  background: white;
  border: 2px solid #333;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.2s;
}

.cell.marked {
  transform: scale(1.2);
}

.cell:hover {
  background: #eaeaea;
}

#game-container {
  display: none;
  animation: fadeIn 0.5s ease;
}

.win {
  animation: winFlash 0.6s infinite alternate;
}

@keyframes fadeIn {
  from {opacity: 0;}
  to {opacity: 1;}
}

@keyframes winFlash {
  from {background: #c8ffc8;}
  to {background: #ffffff;}
}

button, select, input {
  padding: 8px;
  font-size: 16px;
  margin: 5px;
}
</style>
</head>

<body>

<!-- FORMULÃRIO -->
<div id="form-container">
  <h1>Configurar Jogo ðŸŽ®</h1>
  <form onsubmit="startGame(event)">
    <input type="text" id="playerName" placeholder="Nome do jogador" required><br>

    <select id="mode">
      <option value="ai">1 Jogador (vs IA)</option>
      <option value="pvp">2 Jogadores</option>
    </select><br>

    <select id="difficulty">
      <option value="easy">FÃ¡cil</option>
      <option value="medium">MÃ©dio</option>
      <option value="hard">DifÃ­cil</option>
    </select><br>

    <button type="submit">Iniciar</button>
  </form>
</div>

<!-- JOGO -->
<div id="game-container">
  <h1>Jogo da Velha ðŸŽ®</h1>
  <p id="welcome"></p>
  <p id="turn"></p>

  <div id="board"></div>

  <p id="status"></p>

  <p>
    X: <span id="scoreX">0</span> |
    O: <span id="scoreO">0</span> |
    Empates: <span id="scoreD">0</span>
  </p>

  <button onclick="resetGame()">Nova Rodada</button>
  <button onclick="restartGame()">ðŸ”„ Reiniciar jogo</button>
  <button onclick="atualizarPagina()">ðŸ”„ Atualizar PÃ¡gina</button>

</div>

<script>


/* ===== REINICIAR TUDO ===== */
function restartGame(){
  if(!confirm("Deseja reiniciar o jogo e zerar o placar?")) return;

  localStorage.setItem("sx",0);
  localStorage.setItem("so",0);
  localStorage.setItem("sd",0);

  location.reload();
}

/* ================= ATUALIZAR PÃGINA ================= */

function atualizarPagina() {
  location.reload();
}

/* ================= VARIÃVEIS ================= */
const boardElement = document.getElementById("board");
const statusElement = document.getElementById("status");
const turnElement = document.getElementById("turn");
const welcomeElement = document.getElementById("welcome");

let board = Array(9).fill("");
let currentPlayer = "X";
let gameOver = false;

let mode = "ai";
let difficulty = "easy";

/* ====== PLACAR (localStorage) ====== */
let scoreX = Number(localStorage.getItem("scoreX")) || 0;
let scoreO = Number(localStorage.getItem("scoreO")) || 0;
let scoreD = Number(localStorage.getItem("scoreD")) || 0;

updateScore();

/* ================= SONS ================= */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playSound(freq, time = 0.3) {
  const osc = audioCtx.createOscillator();
  osc.connect(audioCtx.destination);
  osc.frequency.value = freq;
  osc.start();
  osc.stop(audioCtx.currentTime + time);
}

function winSound() { playSound(600); }
function loseSound() { playSound(200); }
function drawSound() { playSound(400, 0.2); }

/* ================= JOGO ================= */
const winConditions = [
  [0,1,2],[3,4,5],[6,7,8],
  [0,3,6],[1,4,7],[2,5,8],
  [0,4,8],[2,4,6]
];

function startGame(e) {
  e.preventDefault();

  mode = document.getElementById("mode").value;
  difficulty = document.getElementById("difficulty").value;
  const name = document.getElementById("playerName").value;

  document.getElementById("form-container").style.display = "none";
  document.getElementById("game-container").style.display = "block";

  welcomeElement.innerText =
    mode === "ai" ? `Boa sorte, ${name}! VocÃª Ã© X` : "Modo 2 Jogadores";

  createBoard();
  updateTurn();
}

function createBoard() {
  boardElement.innerHTML = "";
  board.forEach((cell, i) => {
    const div = document.createElement("div");
    div.className = "cell";
    div.innerText = cell;
    div.onclick = () => playerMove(i, div);
    boardElement.appendChild(div);
  });
}

function playerMove(index, cellDiv) {
  if (board[index] || gameOver) return;

  board[index] = currentPlayer;
  cellDiv.classList.add("marked");

  updateGame();

  if (!gameOver && mode === "ai" && currentPlayer === "O") {
    setTimeout(aiMove, 300);
  }
}

function aiMove() {
  let move;

  if (difficulty === "easy") move = randomMove();
  else if (difficulty === "medium")
    move = Math.random() < 0.5 ? randomMove() : bestMove();
  else move = bestMove();

  board[move] = "O";
  updateGame();
}

function randomMove() {
  const empty = board.map((v,i)=>v===""?i:null).filter(v=>v!==null);
  return empty[Math.floor(Math.random()*empty.length)];
}

function bestMove() {
  let best = -Infinity, move;
  board.forEach((c,i)=>{
    if(c===""){
      board[i]="O";
      let s=minimax(board,0,false);
      board[i]="";
      if(s>best){best=s;move=i;}
    }
  });
  return move;
}

function minimax(b, d, max) {
  const r = checkWinner();
  if (r) return r==="O"?10-d:r==="X"?d-10:0;

  let best = max ? -Infinity : Infinity;
  b.forEach((c,i)=>{
    if(c===""){
      b[i]=max?"O":"X";
      let s=minimax(b,d+1,!max);
      b[i]="";
      best = max ? Math.max(best,s) : Math.min(best,s);
    }
  });
  return best;
}

function checkWinner() {
  for (let [a,b,c] of winConditions)
    if (board[a] && board[a]===board[b] && board[a]===board[c])
      return board[a];
  return board.includes("") ? null : "draw";
}

function updateGame() {
  createBoard();
  const w = checkWinner();

  if (w) {
    gameOver = true;
    boardElement.classList.add("win");

    if (w === "draw") {
      scoreD++;
      drawSound();
      statusElement.innerText = "Empate!";
    } else {
      w === "X" ? scoreX++ : scoreO++;
      w === "X" ? winSound() : loseSound();
      statusElement.innerText = `${w} venceu!`;
    }

    saveScore();
    updateScore();
  } else {
    currentPlayer = currentPlayer === "X" ? "O" : "X";
    updateTurn();
  }
}

function updateTurn() {
  turnElement.innerText = `Vez de: ${currentPlayer}`;
}

function saveScore() {
  localStorage.setItem("scoreX", scoreX);
  localStorage.setItem("scoreO", scoreO);
  localStorage.setItem("scoreD", scoreD);
}

function updateScore() {
  document.getElementById("scoreX").innerText = scoreX;
  document.getElementById("scoreO").innerText = scoreO;
  document.getElementById("scoreD").innerText = scoreD;
}

function resetGame() {
  board = Array(9).fill("");
  gameOver = false;
  currentPlayer = "X";
  statusElement.innerText = "";
  boardElement.classList.remove("win");
  createBoard();
  updateTurn();
}
</script>

</body>
</html>
